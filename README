# VFD_AI — модель асинхронного привода с V/f и FOC

Проект моделирует управление трёхфазным асинхронным двигателем двумя способами: скалярное V/f и векторное FOC. Реализована модель двигателя в dq-координатах, идеальный инвертор, контроллеры, сценарии нагрузки, Gym-обёртка, сохранение результатов и отрисовка графиков.

## Структура
- `config/env.py` — все настройки: паспортные данные двигателя, инвертор, V/f и FOC параметры, параметры симуляции. В конце формируется `ENV`.
- `models/` — физические модели:
  - `transformations.py` — Clarke/Park прямые и обратные преобразования.
  - `induction_motor.py` — модель асинхронного двигателя в dq.
  - `inverter_ideal.py` — идеальный инвертор с ограничением по Vdc/√3.
- `control/` — контроллеры:
  - `scalar_vf.py` — V/f с ограничением по U/f, U_boost, плавным пуском (ramp) и фильтрацией момента.
  - `vector_foc.py` — FOC с PI по скорости и токам, ограничением тока/напряжения, интеграцией угла.
- `simulation/` — сценарии и запуск:
  - `scenarios.py` — speed_step, ramp и загрузка.
  - `gym_env.py` — окружение на базе Gym для RL/скриптов.
  - `run_simulation.py` — одиночный прогон, сохраняет `outputs/results/data_<n>.npz`.
- `outputs/plots.py` — построение графиков из NPZ; сохраняет `speed_<n>.png`, `torque_<n>.png`, `currents_<n>.png`, `power_<n>.png`.
- `tests/` — базовые проверки преобразований, инвертора, контроллеров, симуляции.

## Настройка (config/env.py)
- Паспортные данные двигателя (`NAMEPLATE_*`) и вычисляемый коэффициент `VF_K = U_ll / (√3 * f_nom)`.
- V/f: `u_boost=25`, `k_vf=VF_K`, `f_min=1`, `f_max=50`, ramp `df_max=200 Гц/с`, ограничение по фазному U_nom.
- FOC (актуальные настройки по умолчанию):
  - Токовые PI: kp_id=1.0, ki_id=100.0, kp_iq=1.0, ki_iq=100.0.
  - Скоростной PI: kp_speed=0.5, ki_speed=2.5.
  - Ограничения: `iq_limit=2.0 A`, `v_limit=Vdc/√3`.
  - Магнитизация: `id_ref=0.4` (берётся из конфигурации, либо 0.5*I_nom по умолчанию).
- Симуляция: `t_end=3.0`, `dt=1e-4`, режим `SIM_MODE` (scalar/foc), сценарий `speed_step` по умолчанию.

## Запуск
1. Установите зависимости: `py -3 -m pip install numpy matplotlib tqdm`.
2. Запустите симуляцию:
   ```bash
   py -3 simulation/run_simulation.py
   ```
   Результат: `outputs/results/data_<n>.npz`.
3. Построить графики:
   ```bash
   py -3 -c "from outputs.plots import plot_run; plot_run('outputs/results/data_1.npz')"
   ```
   PNG сохраняются в `outputs/figures/` с тем же индексом `<n>`.

## Изменение режимов и параметров
- В `config/env.py` задайте `SIM_MODE = "scalar"` или `"foc"` и поправьте `NAMEPLATE_*`/контроллеры по необходимости.
- Для V/f: регулируйте `u_boost`, `k_vf` (автоматически рассчитывается), `df_max`.
- Для FOC: корректируйте PI коэффициенты и лимиты (`iq_limit`, `v_limit`, `id_ref`).

## Данные и файлы
- Результаты: `outputs/results/data_<n>.npz` (ключи: t, omega_m, omega_ref, T_e, i_a/b/c, P_in, P_out, load_torque, meta).
- Графики: `speed_<n>.png`, `torque_<n>.png`, `currents_<n>.png`, `power_<n>.png` в `outputs/figures/`.

## Тесты
Запуск: `py -3 -m pytest -q`. Проверяются преобразования координат, ограничения инвертора, V/f, FOC и сохранение результатов симуляции.
