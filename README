# MIC_AI — Motor-Independent Cognitive Artificial Intelligence (mic_ai)

Цифровой двойник асинхронного привода с режимами V/f и FOC и набором утилит для идентификации параметров двигателя и построения отчётов.

## Что уже реализовано
- Конфигурация: `config/env.py` хранит номинальные данные двигателя, параметры инвертора, настройки контроллеров (scalar V/f и FOC) и симуляции; есть готовый `ENV` и фабрика `create_default_env()`.
- Модели: dq-модель двигателя (`models/induction_motor.py`), идеальный инвертор (`models/inverter_ideal.py`), преобразования координат (`models/transformations.py`).
- Управление: `control/scalar_vf.py` (открытый контур U/f с ограничением ramp/напряжения) и `control/vector_foc.py` (каскад PI-регуляторов скорости/токов, ограничение напряжения и `iq`).
- Симуляция: Gym-совместимая среда `simulation/gym_env.py` с готовыми сценариями `speed_step`/`ramp`; запуск через `simulation/run_simulation.py` или CLI `python main.py`, сохранение результатов в NPZ с метаданными и построение графиков `outputs/plots.py`.
- Идентификация: минимальная среда прямого задания dq-напряжений `mic_ai/core/env.py`; тестовые профили и раннеры (`mic_ai/ident/test_sequences.py`, `mic_ai/ident/test_runner.py`); оценки Rs/Leq/Lm и уточнение параметров через least-squares с опциональным SciPy (`mic_ai/ident/estimators.py`); сценарии авто- (`run_auto_identification`) и полной идентификации (`run_full_identification`) с расчётом относительных ошибок при наличии истинных параметров (`mic_ai/ident/auto_id.py`, `mic_ai/ident/ident_result.py`, `mic_ai/ident/io.py`).
- CLI-утилиты:
  - `mic_ai/tools/identify_motor.py` — одиночная Rs/Leq идентификация или работа с заранее записанными данными.
  - `mic_ai/tools/full_identify_motor.py` — полный набор тестов (d-step, locked-rotor q, механика) с опциональным self-check.
  - `mic_ai/tools/ident_report.py` — сводный отчёт/печать результатов идентификации.
  - `mic_ai/tools/batch_ident_report.py` — пакетная идентификация по JSONL списку моторов с табличным отчётом.
  - `mic_ai/tools/selfcheck_ident.py` — проверка сходимости идентификации на конфигурации с истинными параметрами.
- Визуализация: `outputs/styles.py` и `outputs/plots.py` строят графики скоростей, моментов, токов и мощностей из сохранённых NPZ.
- Тесты: `tests/test_simulation.py` проверяет работу среды/CLI и сохранение результатов; `tests/test_transformations.py` валидирует преобразования координат; `tests/test_ident_selfcheck.py` (при наличии `config/env_demo_true.py`) запускает self-check идентификации.

## Как запустить симуляцию
```bash
python main.py --mode foc --scenario speed_step --t-end 0.5 --dt 0.0001 --save-prefix run --no-plot
# Построить графики после прогона
python -c "from outputs.plots import plot_run; plot_run('outputs/results/data_1.npz')"
```
Параметры по умолчанию берутся из `config/env.py` (можно переключить `mode` на `scalar` или выбрать другой сценарий).

## Быстрый старт по идентификации
- Простая Rs/Leq идентификация (результат в JSON):
```bash
python mic_ai/tools/identify_motor.py --env-config config/env_demo_true.py --output out/ident_simple.json
```
- Полная идентификация (все тесты) с сохранением JSON:
```bash
python mic_ai/tools/full_identify_motor.py --env-config config/env_demo_true.py --output out/ident_full.json
```
- Пакетная идентификация по списку моторов (JSONL с полями Rs, Rr, Ls, Lr, Lm, J, B[, p, Vdc, ...]):
```bash
python mic_ai/tools/batch_ident_report.py --motors-file tests/motors_100.txt --output reports/motors_report.txt
```

## Тесты
```bash
python -m pytest -q
```
